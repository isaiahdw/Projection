import { AppShell } from "layouts/app_shell.slint";
import { ClockScreen } from "templates/clock.slint";
import { DevicesScreen } from "templates/devices.slint";
import { ErrorScreen } from "templates/error.slint";
import { Routes } from "../../../slint/ui_host/src/generated/routes.slint";

export component AppWindow inherits Window {
    in property <int> vm_rev: 0;
    in property <string> app_title: "Projection Demo";
    in property <string> active_screen: "clock";
    in property <bool> nav_can_back: false;
    in property <string> clock_text: "--:--:--";
    in property <bool> clock_running: true;
    in property <string> clock_timezone: "UTC";

    callback ui_intent(intent_name: string, intent_arg: string);
    callback navigate(route_name: string, params_json: string);
    pure callback vm_text(path: string, rev: int) -> string;
    pure callback vm_list_indices(path: string, rev: int) -> [int];
    pure callback vm_list_row_text(path: string, index: int, field: string, rev: int) -> string;

    width: 480px;
    height: 320px;
    background: #1a1a2e;

    AppShell {
        width: root.width;
        height: root.height;
        app_title: root.app_title;
        show_back: root.nav_can_back;
        nav_back => { root.ui_intent("ui.back", ""); }

        VerticalLayout {
            spacing: 0px;

            // Tab bar
            HorizontalLayout {
                height: 36px;
                spacing: 4px;
                padding-bottom: 12px;

                Rectangle {
                    horizontal-stretch: 1;
                    height: 32px;
                    border-radius: 6px;
                    background: root.active_screen == Routes.clock ? #3a3a6a : (clock_touch.has-hover ? #2a2a4a : transparent);

                    Text {
                        text: "Clock";
                        font-size: 13px;
                        font-weight: root.active_screen == Routes.clock ? 600 : 400;
                        color: root.active_screen == Routes.clock ? #e0e0f0 : #8888bb;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }

                    clock_touch := TouchArea {
                        clicked => {
                            if (root.active_screen != Routes.clock) {
                                root.navigate(Routes.clock, "{}");
                            }
                        }
                    }
                }

                Rectangle {
                    horizontal-stretch: 1;
                    height: 32px;
                    border-radius: 6px;
                    background: root.active_screen == Routes.devices ? #3a3a6a : (devices_touch.has-hover ? #2a2a4a : transparent);

                    Text {
                        text: "Devices";
                        font-size: 13px;
                        font-weight: root.active_screen == Routes.devices ? 600 : 400;
                        color: root.active_screen == Routes.devices ? #e0e0f0 : #8888bb;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }

                    devices_touch := TouchArea {
                        clicked => {
                            if (root.active_screen != Routes.devices) {
                                root.navigate(Routes.devices, "{}");
                            }
                        }
                    }
                }
            }

            // Screen content
            if root.active_screen == Routes.clock: ClockScreen {
                vm_rev: root.vm_rev;
                clock_text: root.clock_text;
                clock_running: root.clock_running;
                clock_timezone: root.clock_timezone;
                intent(intent_name, intent_arg) => { root.ui_intent(intent_name, intent_arg); }
            }

            if root.active_screen == Routes.devices: DevicesScreen {
                vm_rev: root.vm_rev;
                vm_list_indices(path, rev) => { root.vm_list_indices(path, rev); }
                vm_list_row_text(path, index, field, rev) => {
                    root.vm_list_row_text(path, index, field, rev);
                }
            }

            if root.active_screen == "error": ErrorScreen {
                vm_rev: root.vm_rev;
                vm_text(path, rev) => { root.vm_text(path, rev); }
            }
        }
    }
}
